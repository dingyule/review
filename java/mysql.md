# Mysql

## 存储引擎

### MyISAM

### InnoDB

### Memory

## 索引

### 简介

索引是对数据库表中一列或多列的值进行排序的一种结构，使用索引可快速访问数据库表中的特定信息。

### 原理

索引一般以文件形式存在磁盘中（也可以存于内存中），存储的索引的原理大致概括为以空间换时间，数据库在未添加索引的时候进行查询默认的是进行全量搜索，也就是进行全局扫描，有多少条数据就要进行多少次查询，然后找到相匹配的数据就把他放到结果集中，直到全表扫描完。而建立索引之后，会将建立索引的KEY值放在一个n叉树上（BTree），每次以索引进行条件查询时，会去树上根据key值直接进行搜索。

### 优缺点

- 优点
  - 建立索引可以有效缩短数据的检索时间。
- 缺点：
  - 创建索引和维护索引需要时间成本。
  - 创建索引和维护索引需要空间成本，每一条索引都要占据数据库的物理存储空间，数据量越大，占用空间也越大。
  - 降低表的增删改的效率，每次增删改索引需要进行动态维护，导致时间变长。

### 使用场景

数据量较大的情况下，对于查询响应时间不能满足业务需求，可以合理的使用索引提升查询效率。

### 基本索引类型

#### 普通索引

单列索引是最基本的索引，它没有任何限制

```sql
ALTER TABLE table_name ADD INDEX index_name (column)
```

#### 组合索引

组合索引，即一个索引包含多个列。

```sql
ALTER TABLE table_name ADD INDEX index_name(column1, column2, column3)
```

#### 唯一索引

唯一索引列的值必须唯一，但允许有空值。

```sql
ALTER table mytable ADD UNIQUE [indexName] (username(length))
```

#### 主键索引

一种特殊的唯一索引，不允许有空值。一般是在建表的时候同时创建主键索引。

```sql
alter table tbl_name add primary key(col_name);
```

#### 全文索引

全文索引主要用来查找文本中的关键字。

```sql
ALTER TABLE table_name ADD FULLTEXT (column)
```

### 创建索引语句

```sql
ALTER table tableName ADD INDEX indexName(columnName)
```

### 索引失效原因

1. 在where后使用or，导致索引失效。
2. 使用in导致索引失效。
3. 如果列类型是字符串，一定要在条件中将数据使用引号引用起来,否则不使用索引。
4. 使用like ，like查询是以%开头。
5. 复合索引遵守“最左前缀”原则，即在查询条件中使用了复合索引的第一个字段，索引才会被使用。

## 锁

### 全局锁

### 表级锁

### 行锁

## 事务

### 基本特性ACID

- **原子性：**一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。
- **一致性：**在事务开始之前和事务结束以后，数据库的完整性没有被破坏。
- **隔离性：**数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括：
  - 读未提交（Read uncommitted）：可能会读到其他事务未提交的数据，也叫做脏读。
  - 读提交（read committed）：读已提交，两次读取结果不一致，叫做不可重复读。 
  - 可重复读（repeatable read）：mysql的默认级别，就是每次读取结果都一样，但是有可能产生幻读。 
  - 串行化（Serializable）：给每一行读取的数据加锁，会导致大量超时和锁竞争的问题。
- **持久性：**事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

## 优化